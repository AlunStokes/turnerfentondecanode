function insertAttendanceQuestions(t){$("#attendance-option-A").text(t.optionA),$("#attendance-option-B").text(t.optionB),$("#attendance-option-C").text(t.optionC),$("#attendance-option-D").text(t.optionD)}function loadAttendance(t){$.ajax({type:"GET",url:"ajax",data:{ajaxid:"getAttendanceData"}}).done(function(e){e.err?t(e.err):t(null,e)})}function selectOption(t){var e=options.indexOf(t);clicked.setAll(0),clicked[e]=1,shownInfoCount<2&&(notify("Click the option again to confirm your choice","info","check"),shownInfoCount++),updateClasses()}function confirmOption(t){var e=options.indexOf(t);clicked.setAll(0),clicked[e]=2,tries++,submitted=!0,updateClasses(),checkAnswer(function(e,n){if(!e)return n?(notify("Your attendance has been logged","success","check"),void $("#attendance-status").text("Your attendance has been logged")):(1==tries?(notify("That is not the correct option","warning","exclamation"),$("#attendance-status").text("You have 1 more try")):(notify("You have been locked out of this attendance session","danger","exclamation"),$("#attendance-status").text("You have been locked out of this session")),$("#attendance-option-"+t).addClass("attendance-incorrect"),void setTimeout(function(){resetAttendance()},800));notify(e,"danger","exclamation")})}function resetAttendance(){submitted=!1,clicked.setAll(0),updateClasses()}function checkAnswer(t){$.ajax({type:"POST",url:"ajax",data:{ajaxid:"checkAttendanceAnswer",answer:options[clicked.indexOf(2)]}}).done(function(e){e.err?t(e.err):t(null,e.correct)})}function updateClasses(){for(var t=0;t<clicked.length;t++)0==clicked[t]?($("#attendance-option-"+options[t]).removeClass("attendance-selected"),$("#attendance-option-"+options[t]).removeClass("attendance-confirmed"),$("#attendance-option-"+options[t]).removeClass("attendance-incorrect")):1==clicked[t]?($("#attendance-option-"+options[t]).addClass("attendance-selected"),$("#attendance-option-"+options[t]).removeClass("attendance-confirmed"),$("#attendance-option-"+options[t]).removeClass("attendance-incorrect")):2==clicked[t]&&($("#attendance-option-"+options[t]).removeClass("attendance-selected"),$("#attendance-option-"+options[t]).addClass("attendance-confirmed"),$("#attendance-option-"+options[t]).removeClass("attendance-incorrect"))}var options=["A","B","C","D"],clicked=[0,0,0,0],tries=0,active=!0,submitted=!1,shownInfoCount=0;$(document).ready(function(){loadAttendance(function(t,e){if(!t)return e.attendanceOpen?e.attendanceCompleted?($("#attendance-status").text("Your attendance has been logged"),submitted=!0,active=!1,$("#attendance-option-"+e.attendanceAnswer).addClass("attendance-confirmed"),void insertAttendanceQuestions(e.attendanceOptions)):void(0==e.triesLeft?(tries=2,active=!1,$("#attendance-status").text("You have been locked out of this session"),insertAttendanceQuestions(e.attendanceOptions)):2!=e.triesLeft?(tries=2-e.triesLeft,$("#attendance-status").text("You have "+e.triesLeft+" try left"),insertAttendanceQuestions(e.attendanceOptions)):(tries=2-e.triesLeft,$("#attendance-status").text("A session is currently open"),insertAttendanceQuestions(e.attendanceOptions))):(active=!1,$("#attendance-status").text("No attendance session is currently open"),void $("#attendance-icon").removeClass("icon-success").addClass("icon-danger"));notify("Error loading attendance - try again later","danger","exclamation")})}),$(document).on("click touchstart",".attendance-option",function(){if(!(tries>=2||submitted)&&active){var t=this.id.charAt(this.id.length-1),e=clicked[options.indexOf(t)];0==e?selectOption(t):1==e&&confirmOption(t)}}),Array.prototype.setAll=function(t){var e,n=this.length;for(e=0;e<n;++e)this[e]=t};