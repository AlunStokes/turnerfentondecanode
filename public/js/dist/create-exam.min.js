function validateExam(e){void 0!==examName&&""!=examName?(examName.length<3&&e("Exam name must be at least 3 characters"),e(0!=inExam.length?null:"Exam must have questions in it")):e("Exam must have a name")}function submitExam(e){for(var t=[],n=0;n<inExam.length;n++)t.push(inExam[n].questionid);$.ajax({type:"POST",url:"ajax",data:{ajaxid:"createExam",examCluster:examCluster,examShowScore:examShowScore,examUnlocked:examUnlocked,examName:examName,examQuestions:JSON.stringify(t)}}).done(function(t){e(t.err?t.err:null)})}function addToExam(e,t){inExam.push(e),loadedQuestions.clean(e),reloadQuestionAreas()}function removeFromExam(e,t){inExam.clean(e),searchIndicies.includes(e.questionid)&&loadedQuestions.push(e),reloadQuestionAreas()}function loadQuestions(e,t,n,o){$.ajax({type:"GET",url:"ajax",data:{ajaxid:"getQuestionList",cluster:e,offset:n,search:t,questionsPer:questionsPer}}).done(function(e){questionsLoaded+=e.length;for(var t=e,n=0;n<inExam.length;n++)loadedIndices.push(inExam[n].questionid);for(n=0;n<e.length;n++)searchIndicies.push(e[n].questionid),-1!=indexInArrayObject(inExam,"questionid",t[n].questionid)?(t.splice(n,1),n--):loadedIndices.push(t[n].questionid);loadedQuestions=loadedQuestions.concat(t),o(e)})}function reloadQuestionAreas(){replaceQuestionsNotAdded(loadedQuestions),replaceQuestionsAdded(inExam)}function addQuestionsNotAdded(e){$("#load-more")&&$("#load-more").remove();var t="";0==e.length?t='<h1 class="text small thin dark">no more results</h1>':(t+=generateQuestionsHTML(e,!1),t+='<button class="btn btn-lg btn-block active-color" id="load-more">Load more</button>'),questionAreaNotAdded.append(t)}function replaceQuestionsNotAdded(e){questionsLoaded=questionsPer;var t="";0==e.length?t='<h1 class="text small thin dark">0 results returned</h1>':(t+=generateQuestionsHTML(e,!1),t+='<button class="btn btn-lg btn-block active-color" id="load-more">Load more</button>'),questionAreaNotAdded.html(t)}function addQuestionsAdded(e){var t="";t+=generateQuestionsHTML(e,!0),questionAreaAdded.append(t)}function replaceQuestionsAdded(e){var t="";t+=generateQuestionsHTML(e,!0),questionAreaAdded.html(t)}function generateQuestionsHTML(e,t){for(var n="",o=0;o<e.length;o++)n+=generateQuestionHTML(e[o],t,o);return n}function generateQuestionHTML(e,t,n){var o="",s=["A","B","C","D"];o+='<div class="question" id="question-'+e.questionid+'"><div class="row"><div class="col-lg-10 col-xs-9"><h1 class="text small thin dark">',t&&(o+="<i><b>"+(questionsLoaded-questionsPer+n+1)+". </b></i>"),o+=e.question+'</h1></div><div class="col-lg-2 col-xs-3">',o+=t?'<button class="btn btn-defult active-color remove-question" style="float:right;" id="remove-question-'+e.questionid+'">Remove</button>':'<button class="btn btn-defult active-color add-question" style="float:right;" id="add-question-'+e.questionid+'">Add</button>',o+="</div></div><br>";for(var a=0;a<4;a++)o+='<div class="row"><div class="col-lg-8 col-xs-10"><label for="rb-'+n+"-"+s[a]+'"><h1 class="text xsmall thin dark"><i><b>'+s[a]+". </b></i>"+e["option"+s[a]]+"</h1></div></div>";return o+='<div class="row"><div class="col-lg-8 col-xs-10"<h1 class="text xsmall thin dark"><i>Answer: '+e.answer+"</i></h1></div></div><hr></div>"}function getNum(e){return e.match(/\d+/)[0]}function indexInArrayObject(e,t,n){for(var o=0;o<e.length;o++)if(e[o][t]==n)return o;return-1}var loadQuestionsCluster,searchInput,questionAreaNotAdded,questionAreaAdded,examCluster="mix",examUnlocked=1,examShowScore=1,examName,inExam=[],loadedQuestions=[],loadedIndices=[],searchIndicies=[],questionsLoaded=0,questionsPer=25,questionsCluster,search;$(document).ready(function(){loadQuestionsCluster=$("#load-questions-cluster"),searchInput=$("#search-input"),questionAreaNotAdded=$("#question-area-not-added"),questionAreaAdded=$("#question-area-added"),questionsCluster=loadQuestionsCluster.val(),search=searchInput.val();var e=loadQuestions(questionsCluster,search,questionsLoaded,function(e){addQuestionsNotAdded(e)});$(document).on("click","#load-more",function(){e=loadQuestions(questionsCluster,search,questionsLoaded,function(e){addQuestionsNotAdded(e)})}),searchInput.on("keyup",function(){search=searchInput.val(),loadedQuestions=[],loadedIndices=[],searchIndicies=[],e=loadQuestions(questionsCluster,search,questionsLoaded=0,function(e){replaceQuestionsNotAdded(e)})}),loadQuestionsCluster.on("change",function(){questionsCluster=loadQuestionsCluster.val(),loadedQuestions=[],loadedIndices=[],searchIndicies=[],e=loadQuestions(questionsCluster,search,questionsLoaded=0,function(e){replaceQuestionsNotAdded(e)})}),$(document).on("click",".add-question",function(){var e=getNum(this.id),t=indexInArrayObject(loadedQuestions,"questionid",e);addToExam(loadedQuestions[t],e)}),$(document).on("click",".remove-question",function(){var e=getNum(this.id),t=indexInArrayObject(inExam,"questionid",e);removeFromExam(inExam[t],e)}),$(document).on("change","#exam-cluster-dropdown",function(){examCluster=this.value}),$(document).on("change","#exam-locked-dropdown",function(){examUnlocked=1==this.value}),$(document).on("change","#exam-score-dropdown",function(){examShowScore=1==this.value}),$("#exam-name-input").on("keyup",function(){examName=$("#exam-name-input").val()}),$("#start-another-exam-btn").on("click",function(e){e.preventDefault(),confirm("Are you sure? You will lose unsubmitted progress on this current exam.")&&location.reload()}),$("#submit-exam-btn").on("click",function(e){e.preventDefault(),validateExam(function(e){e?alert(e):submitExam(function(e){e?alert(e):alert("Exam successfully created - you may leave this page")})})})}),Array.prototype.clean=function(e){for(var t=0;t<this.length;t++)this[t]==e&&(this.splice(t,1),t--);return this};