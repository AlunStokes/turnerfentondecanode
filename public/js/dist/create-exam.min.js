function validateExam(e){e(void 0!==examName&&""!=examName?examName.length<3?"Exam name must be at least 3 characters":0!=inExam.length?null:"Exam must have questions in it":"Exam must have a name")}function submitExam(e){for(var n=[],t=0;t<inExam.length;t++)n.push(inExam[t].questionid);$.ajax({type:"POST",url:"ajax",data:{ajaxid:"createExam",examCluster:examCluster,examShowScore:examShowScore,examUnlocked:examUnlocked,examShowTimer:examShowTimer,examName:examName,examQuestions:JSON.stringify(n)}}).done(function(n){e(n.err?n.err:null)})}function addToExam(e,n){inExam.push(e),loadedQuestions.clean(e),reloadQuestionAreas()}function removeFromExam(e,n){inExam.clean(e),searchIndicies.includes(e.questionid)&&loadedQuestions.push(e),reloadQuestionAreas()}function loadQuestions(e,n,t,o){$.ajax({type:"GET",url:"ajax",data:{ajaxid:"getQuestionList",cluster:e,offset:t,search:n,questionsPer:questionsPer}}).done(function(e){questionsLoaded+=e.length;for(var n=e,t=0;t<inExam.length;t++)loadedIndices.push(inExam[t].questionid);for(t=0;t<e.length;t++)searchIndicies.push(e[t].questionid),-1!=indexInArrayObject(inExam,"questionid",n[t].questionid)?(n.splice(t,1),t--):loadedIndices.push(n[t].questionid);loadedQuestions=loadedQuestions.concat(n),o(e)})}function reloadQuestionAreas(){replaceQuestionsNotAdded(loadedQuestions),replaceQuestionsAdded(inExam)}function addQuestionsNotAdded(e){$("#load-more")&&$("#load-more").remove();var n="";0==e.length?n='<h1 class="text small thin dark">no more results</h1>':(n+=generateQuestionsHTML(e,!1),n+='<button class="btn btn-lg btn-block active-color" id="load-more">Load more</button>'),questionAreaNotAdded.append(n)}function replaceQuestionsNotAdded(e){questionsLoaded=questionsPer;var n="";0==e.length?n='<h1 class="text small thin dark">0 results returned</h1>':(n+=generateQuestionsHTML(e,!1),n+='<button class="btn btn-lg btn-block active-color" id="load-more">Load more</button>'),questionAreaNotAdded.html(n)}function addQuestionsAdded(e){var n="";n+=generateQuestionsHTML(e,!0),questionAreaAdded.append(n)}function replaceQuestionsAdded(e){var n="";n+=generateQuestionsHTML(e,!0),questionAreaAdded.html(n)}function generateQuestionsHTML(e,n){for(var t="",o=0;o<e.length;o++)t+=generateQuestionHTML(e[o],n,o);return t}function generateQuestionHTML(e,n,t){var o="",s=["A","B","C","D"];o+='<div class="question" id="question-'+e.questionid+'"><div class="row"><div class="col-lg-10 col-xs-9"><h1 class="text small thin dark">',n&&(o+="<i><b>"+(questionsLoaded-questionsPer+t+1)+". </b></i>"),o+=e.question+'</h1></div><div class="col-lg-2 col-xs-3">',o+=n?'<button class="btn btn-defult active-color remove-question" style="float:right;" id="remove-question-'+e.questionid+'">Remove</button>':'<button class="btn btn-defult active-color add-question" style="float:right;" id="add-question-'+e.questionid+'">Add</button>',o+="</div></div><br>";for(var a=0;a<4;a++)o+='<div class="row"><div class="col-lg-8 col-xs-10"><label for="rb-'+t+"-"+s[a]+'"><h1 class="text xsmall thin dark"><i><b>'+s[a]+". </b></i>"+e["option"+s[a]]+"</h1></div></div>";return o+='<div class="row"><div class="col-lg-8 col-xs-10"<h1 class="text xsmall thin dark"><i>Answer: '+e.answer+"</i></h1></div></div><hr></div>"}function getNum(e){return e.match(/\d+/)[0]}function indexInArrayObject(e,n,t){for(var o=0;o<e.length;o++)if(e[o][n]==t)return o;return-1}var loadQuestionsCluster,searchInput,questionAreaNotAdded,questionAreaAdded,examCluster="mix",examUnlocked=!0,examShowScore=!0;examShowTimer=!0;var examName,inExam=[],loadedQuestions=[],loadedIndices=[],searchIndicies=[],questionsLoaded=0,questionsPer=25,questionsCluster,search;$(document).ready(function(){loadQuestionsCluster=$("#load-questions-cluster"),searchInput=$("#search-input"),questionAreaNotAdded=$("#question-area-not-added"),questionAreaAdded=$("#question-area-added"),questionsCluster=loadQuestionsCluster.val(),search=searchInput.val();var e=loadQuestions(questionsCluster,search,questionsLoaded,function(e){addQuestionsNotAdded(e)});$(document).on("click","#load-more",function(){e=loadQuestions(questionsCluster,search,questionsLoaded,function(e){addQuestionsNotAdded(e)})}),searchInput.on("keyup",function(){search=searchInput.val(),loadedQuestions=[],loadedIndices=[],searchIndicies=[],e=loadQuestions(questionsCluster,search,questionsLoaded=0,function(e){replaceQuestionsNotAdded(e)})}),loadQuestionsCluster.on("change",function(){questionsCluster=loadQuestionsCluster.val(),loadedQuestions=[],loadedIndices=[],searchIndicies=[],e=loadQuestions(questionsCluster,search,questionsLoaded=0,function(e){replaceQuestionsNotAdded(e)})}),$(document).on("click",".add-question",function(){var e=getNum(this.id),n=indexInArrayObject(loadedQuestions,"questionid",e);addToExam(loadedQuestions[n],e)}),$(document).on("click",".remove-question",function(){var e=getNum(this.id),n=indexInArrayObject(inExam,"questionid",e);removeFromExam(inExam[n],e)}),$(document).on("change","#exam-cluster-dropdown",function(){examCluster=this.value}),$(document).on("change","#exam-locked-dropdown",function(){examUnlocked=1==this.value}),$(document).on("change","#exam-score-dropdown",function(){examShowScore=1==this.value}),$(document).on("change","#exam-timer-dropdown",function(){examShowTimer=1==this.value}),$("#exam-name-input").on("keyup",function(){examName=$("#exam-name-input").val()}),$("#start-another-exam-btn").on("click",function(e){e.preventDefault(),confirm("Are you sure? You will lose unsubmitted progress on this current exam.")&&location.reload()}),$("#submit-exam-btn").on("click",function(e){e.preventDefault(),validateExam(function(e){e?notify(e,"danger","exclamation"):submitExam(function(e){e?notify(e,"danger","exclamation"):notify("Exam successfully created - you may leave this page","success","check")})})})}),Array.prototype.clean=function(e){for(var n=0;n<this.length;n++)this[n]==e&&(this.splice(n,1),n--);return this};