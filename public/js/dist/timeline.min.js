function loadPosts(t,e){$.ajax({type:"POST",url:"ajax",data:{ajaxid:"getTimelineData",offset:t,postsPer:e}}).done(function(t){if(t.err)notify(err,"danger","exclamation");else{posts=t.posts,questionsLoaded+=e;for(var s="",i=0;i<posts.length;i++)posts[i].class=valueToCluster(posts[i].class),(i>0&&posts[i].date!=posts[i-1].date||0==i)&&(s+='<div class="timeline-header"><div class="timeline-header-title bg-success">'+posts[i].date+"</div></div>"),s+=buildPost(posts[i].id,posts[i].posterStudentNumber,posts[i].time,posts[i].posterFirstName,posts[i].posterLastName,posts[i].messageHTML,posts[i].class);posts.length<e?s+='<h1 class="text large thin dark center">no more posts</h1>':s+='<button class="btn btn-lg btn-block active-color" id="load-more-posts">Load more</button>',$("#timeline").append(s)}})}function startEditPost(t){var e=getIndexById(posts,t),s=$("#post-body-"+t),i=$("#post-footer-"+t),o=clusterToValue(posts[e].class);s.html('<textarea id="edit-post-textarea-'+t+'"></textarea>'),i.html('<select class="form-control" id="post-class-'+t+'" style="width:50%; display:inline;"><option value="all">All Classes</option><option value="writtens">Writtens</option><option value="marketing">Marketing</option><option value="businessadmin">Business Administration</option><option value="finance">Finance</option><option value="hospitality">Hospitality & Tourism</option></select><button type="button" class="btn btn-default save-edit-btn active-color" id="save-edit-btn-'+t+'" style="display:inline; float:right;">Save Post</button>'),$("#edit-"+t).css("display","none"),$("#post-class-"+t).val(o),editPostBoxArray[t]=new SimpleMDE({element:$("#edit-post-textarea-"+t)[0],toolbar:["bold","italic","heading","strikethrough","quote","unordered-list","ordered-list","link","|","preview","guide"],initialValue:posts[getIndexById(posts,t)].messageMarkdown})}function finishEditPost(t){var e=editPostBoxArray[t].options.previewRender(editPostBoxArray[t].value()),s=editPostBoxArray[t].value(),i=$("#post-class-"+t).val();updatePost(t,e,s,i,function(o){if(!o){var a=getIndexById(posts,t);posts[a].messageHTML=e,posts[a].messageMarkdown=s,posts[a].class=valueToCluster(i);var n=buildPost(t,posts[a].posterStudentNumber,posts[a].time,posts[a].posterFirstName,posts[a].posterLastName,posts[a].messageHTML,posts[a].class);$("#post-"+t).replaceWith(n),editPostBoxArray[a]=null}})}function deletePost(t){var e=$("#post-"+t);$.ajax({type:"POST",url:"ajax",data:{ajaxid:"deletePost",postid:t}}).done(function(t){t.err?$.notify({icon:"fa fa-exclamation-triangle",message:t.err},{type:"danger",timer:3e3,placement:{from:"bottom",align:"right"}}):($.notify({icon:"fa fa-check",message:"Post was successfully deleted"},{type:"success",timer:3e3,placement:{from:"bottom",align:"right"}}),e.replaceWith(""))})}function updatePost(t,e,s,i,o){$.ajax({type:"POST",url:"ajax",data:{ajaxid:"updatePost",postid:t,messageHTML:e,messageMarkdown:s,messageClass:i}}).done(function(t){return t.err?($.notify({icon:"fa fa-exclamation-triangle",message:t.err},{type:"danger",timer:3e3,placement:{from:"bottom",align:"right"}}),void o(t.err)):($.notify({icon:"fa fa-check",message:"Post successfully edited"},{type:"success",timer:3e3,placement:{from:"bottom",align:"right"}}),void o(null))})}function getIndexById(t,e){for(var s=0;s<t.length;s++)if(t[s].id==e)return s;return-1}function getNum(t){return t.match(/\d+/)[0]}function buildPost(t,e,s,i,o,a,n){var r="";return r+='<div class="timeline-entry" id="post-'+t+'"><div class="timeline-stat">',r+='<div class="timeline-icon"><img src="images/users/thumbnail/'+e+'.jpg" alt="Profile picture"></div>',r+='<div class="timeline-time">'+s+"</div>",r+='</div><div class="timeline-label">',admin&&(r+='<div><span class="delete" id="delete-'+t+'"><i class="fa fa-times"></i></span><span class="edit" id="edit-'+t+'"><i class="fa fa-pencil"></i></span></div>'),r+='<h4 class="text-info mar-no pad-btm">'+i+" "+o+'</h4><div class="timeline-post-body" id="post-body-'+t+'">'+a+'</div><div class="footer" id="post-footer-'+t+'"><hr style="margin-top:10px; margin-bottom:10px;" /><p class="text xsmall right" id="post-class-'+t+'">'+n+"</p></div></div></div>"}function clusterToValue(t){switch(t){case"All Clusters":return"all";case"Marketing":return"marketing";case"Finance":return"finance";case"Business Administration":return"businessadmin";case"Hospitality & Tourism":return"hospitality";case"Writtens":return"writtens";default:return"undefined"}}function valueToCluster(t){switch(t){case"all":return"All Clusters";case"marketing":return"Marketing";case"finance":return"Finance";case"businessadmin":return"Business Administration";case"hospitality":return"Hospitality & Tourism";case"writtens":return"Writtens";default:return"undefined"}}var timeline=$("#timeline"),questionsLoaded=0,postsPer=12,editPostBoxArray=[],posts;$(document).ready(function(){loadPosts(questionsLoaded,postsPer)}),$(document).on("click","#load-more-posts",function(){$("#load-more-posts").remove(),loadPosts(questionsLoaded,postsPer)}),$(document).on("click",".edit",function(){startEditPost(getNum(this.id))}),$(document).on("click",".save-edit-btn",function(){finishEditPost(getNum(this.id))}),$(document).on("click",".delete",function(){confirm("Are you sure you want to delete this post?")&&deletePost(getNum(this.id))});