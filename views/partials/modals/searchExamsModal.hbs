<div class="modal fade" id="find-exams-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="padding: 11px">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Search Exam Questions</h4>
      </div>
      <br>
      <div class="row">
        <div class="col-lg-8 col-xs-7">
          <input tpye="text" id="exams-search-input" class="question-search" placeholder="Write words in exam name" style="width:100%; font-size:14px; height:30px;" />
        </div>
        <div class="col-lg-4 col-xs-5">
          <select style="text-align:right; min-height:30px; width:100%; width:100%;" id="exam-cluster-input">
            <option value="mix">All Clusters</option>
            <option value="marketing">Marketing</option>
            <option value="businessadmin">Business Administration</option>
            <option value="finance">Finance</option>
            <option value="hospitality">Hospitality & Tourism</option>
          </select>
        </div>
      </div>
      <br>
      <div id="exams-area" class="question-area">

      </div>
    </div>
  </div>
</div>


<script>

  var examsSearch = "";
  var examsCluster = "mix";
  var examsPer = 25;

  var examsLoaded = 0;
  var loadedExams = [];

  var examsSeachInput;
  var examsClusterInput;
  var examsArea;

$(document).ready(function() {

  examsSeachInput = $("#exams-search-input");
  examsClusterInput = $("#exam-cluster-input");
  examsArea = $("#exams-area");

  //Initialise questions
  loadExams(examsCluster, examsSearch, examsLoaded, function(examList) {
    addExams(examList);
  });


  $(document).on('click', "#load-more-exams", function() {
    loadExams(examsCluster, examsSearch, examsLoaded, function(examList) {
      addExams(examList);
    });
  });

  examsSeachInput.on('keyup', function() {
    examsSearch = examsSeachInput.val();
    //Set to zero to reset num questions
    examsLoaded = 0;
    loadExams(examsCluster, examsSearch, examsLoaded, function(examList) {
      replaceExams(examList);
    });
  });

  examsClusterInput.on('change', function() {
    examsCluster = examsClusterInput.val();
    //Set to zero to reset num questions
    examsLoaded = 0;
    loadExams(examsCluster, examsSearch, examsLoaded, function(examList) {
      replaceExams(examList);
    });
  });

  $(document).on('click', '.btn-start-exam', function() {
    var id = getNum(this.id);
  });
});

function loadExams(cluster, search, offset, callback) {
  $.ajax({
    type: "GET",
    url: "ajax",
    data: {
      ajaxid: "searchExams",
      cluster: cluster,
      search: search,
      offset: offset,
      examsPer: examsPer
    }
  }).done(function(data) {
    if (data.err) {
      alert ("Server error - try again later");
      return;
    }
    examsLoaded += data.length;
    loadedExams = loadedExams.concat(data);
    callback(data);
    return;
  });
}

function addExams(exams) {
  //Remove current load more button
  if ($("#load-more-exams")) {
    $("#load-more-exams").remove();
  }
  var html = '';
  if (exams.length == 0) {
    html = '<h1 class="text small thin dark">no more results</h1>';
  }
  else {
    html += generateExamsHTML(exams);
    //Add more button
    html += '<button class="btn btn-lg btn-block active-color" id="load-more-exams">Load more</button>';
  }
  console.log(html);
  examsArea.append(html);
}

function replaceExams(exams) {
  examsLoaded = examsPer;
  var html = '';
  if (exams.length == 0) {
    html = '<h1 class="text small thin dark">0 results returned</h1>';
  }
  else {
    html += generateExamsHTML(exams);
    //Add more button
    html += '<button class="btn btn-lg btn-block active-color" id="load-more-exams">Load more</button>';
  }
  examsArea.html(html);
}



function generateExamHTML(exam) {
  var html = '';
  html += '<div class="row exam">';
  if (admin) {
    if (exam.unlocked) {
      html += '<div class="row">' +
      '<div class="col-xs-6 col-lg-6">' +
      '<label class="switch">' +
      '<input type="checkbox" class="unlocked-slider" id="unlocked-exam-' + exam.id + '" checked>' +
      '<div class="slider round"></div>' +
      '</label>' +
      '<i><p>Unlocked</p></i>' +
      '</div>';
    }
    else {
      html += '<div class="row">' +
      '<div class="col-xs-6 col-lg-6">' +
      '<label class="switch">' +
      '<input type="checkbox" class="unlocked-slider" id="unlocked-exam-' + exam.id + '">' +
      '<div class="slider round"></div>' +
      '</label>' +
      '<i><p>Locked</p></i>' +
      '</div>';
    }
    html += '<div class="col-xs-6 col-lg-6">' +
    '<h3 class="truncate text thin dark small exam-name">' + exam.name + '</h3>' +
    '<p class="text thin dark xsmall exam-name">' + exam.cluster + '</p>' +
    '<p class="text thin dark xsmall exam-name">' + exam.numQuestions + ' Questions</p>' +
    '</div>' +
    '</div>';
    if (!exam.showScore) {
      html += '<div class="row">' +
      '<div class="col-xs-6 col-lg-6">' +
      '<p class="text thin dark xsmall italic">Score will not be shown</p>' +
      '</div>';
    }
    else {
      html += '<div class="row">' +
      '<div class="col-xs-6 col-lg-6">' +
      '</div>';
    }
    html += '<div class="col-xs-6 col-lg-6">' +
    '<form method="POST" action="exam">' +
    '<button class="btn btn-start-exam active-color" style="float:right" id="start-exam-' + exam.id + '"> Start Exam </button>' +
    '<input type="hidden" name="examid" value="' + exam.id + '" />' +
    '</form>' +
    '</div>' +
    '</div>' +
    '</div>' +
    '<hr width="60%"></hr>';
  }
  else {
    html += '<div class="row">' +
    '<div class="col-xs-6 col-xs-offset-6 col-lg-6 col-lg-offset-6">' +
    '<h3 class="truncate text thin dark small exam-name">' + exam.name + '</h3>' +
    '<p class="text thin dark xsmall exam-name">' + exam.cluster + '</p>' +
    '<p class="text thin dark xsmall exam-name">' + exam.numQuestions + ' Questions</p>' +
    '</div>' +
    '</div>';
    if (!exam.showScore) {
      html += '<div class="row">' +
      '<div class="col-xs-6 col-lg-6">' +
      '<p class="text thin dark xsmall italic">Score will not be shown</p>' +
      '</div>';
    }
    else {
      html += '<div class="row">' +
      '<div class="col-xs-6 col-lg-6">' +
      '</div>';
    }
      html += '<div class="col-xs-6 col-lg-6">';
      if (exam.unlocked) {
        html += '<form method="POST" action="exam">' +
        '<button class="btn btn-start-exam active-color" style="float:right" id="start-exam-' + exam.id + '"> Start Exam </button>' +
        '<input type="hidden" name="examid" value="' + exam.id + '" />' +
        '</form>';
      }
      else {
        html += '<button class="btn btn-start-exam active-color" style="float:right" id="start-exam-' + exam.id + '" disabled> Start Exam </button>';
      }
      html += '</div>' +
      '</div>' +
      '</div>' +
      '</div>' +
      '<hr width="60%"></hr>';
  }
  return html;
}

function generateExamsHTML(exams) {
  var html = '';
  for (var i = 0; i < exams.length; i++) {
    html += generateExamHTML(exams[i]);
  }
  return html;
}

</script>
